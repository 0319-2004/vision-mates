# VisionMates 6機能追加 - セットアップガイド

## 前提条件

- Node.js 18以上
- Supabaseプロジェクト（PostgreSQL）
- 既存のVisionMatesプロジェクト（Next.js 14 + TypeScript + Tailwind）

## セットアップ手順

### 1. データベース設定

1. Supabaseダッシュボードにアクセス
2. SQL Editorを開く
3. `database_setup.sql`の内容をコピー&ペーストして実行
4. 実行完了を確認

### 2. プロジェクトファイルの追加

以下のファイルが追加されていることを確認：

```
app/
├── discover/page.tsx                    # ①スワイプ発見
├── rooms/
│   ├── page.tsx                        # ②共同作業スプリント一覧
│   └── [id]/page.tsx                   # ②共同作業スプリント詳細
├── profile/page.tsx                    # ③ストリークリング
├── seeds/new/page.tsx                  # ④企画テンプレ
└── projects/[id]/
    └── threads/
        ├── page.tsx                    # ⑥スレッド一覧
        └── [threadId]/page.tsx         # ⑥スレッド詳細

components/
├── SwipeCard.tsx                       # ①スワイプカード
├── CreateRoomForm.tsx                  # ②ルーム作成
├── RoomCard.tsx                        # ②ルームカード
├── FocusRoom.tsx                       # ②フォーカスルーム
├── StreakRing.tsx                      # ③ストリークリング
├── AchievementList.tsx                 # ⑤功績リスト
├── SeedForm.tsx                        # ④企画テンプレ
├── CreateThreadForm.tsx                # ⑥スレッド作成
├── ThreadList.tsx                      # ⑥スレッドリスト
├── MessageList.tsx                     # ⑥メッセージリスト
└── MessageForm.tsx                     # ⑥メッセージ投稿

data/
└── idea-templates.json                 # ④企画テンプレデータ

lib/
└── achievements.ts                     # ⑤功績定義

types/
└── index.ts                           # 型定義更新
```

### 3. 依存関係の確認

`package.json`に以下が含まれていることを確認：

```json
{
  "dependencies": {
    "@supabase/supabase-js": "^2.39.0",
    "react-hot-toast": "^2.6.0"
  }
}
```

### 4. 環境変数の確認

`.env.local`に以下が設定されていることを確認：

```env
NEXT_PUBLIC_SUPABASE_URL=your_supabase_url
NEXT_PUBLIC_SUPABASE_ANON_KEY=your_supabase_anon_key
```

## 動作確認手順

### 1. 開発サーバー起動

```bash
npm run dev
```

http://localhost:3000 にアクセス

### 2. ①スワイプ発見機能

1. `/discover`にアクセス
2. プロジェクトカードが表示されることを確認
3. 「👀 気になる」ボタンをクリック
   - 未ログイン時：ログイン促しモーダルが表示される
   - ログイン時：intentsテーブルにwatchレコードが追加され、次のカードが表示される
4. 「スキップ」ボタンをクリック
   - 次のカードが表示される

### 3. ②共同作業スプリント機能

1. `/rooms`にアクセス
2. 「新しいルームを作成」でルームを作成
3. 作成したルームをクリックして詳細ページに移動
4. 2つのブラウザで同じルームにアクセス
5. 「開始」ボタンをクリック
   - 両方のブラウザで25分タイマーが開始される
   - 参加者リストに両方のユーザーが表示される
6. 「👏 拍手を送る」ボタンをクリック
   - 両方のブラウザで拍手数が更新される

### 4. ③ストリークリング機能

1. `/profile`にアクセス（ログイン必須）
2. 連続投稿日数のリングが表示されることを確認
3. プロジェクト詳細で進捗を投稿
4. プロフィールページを再読み込み
   - リングが更新されることを確認

### 5. ④企画テンプレ機能

1. `/seeds/new`にアクセス
2. テンプレートを選択
3. フォーム項目を入力
4. プレビューが更新されることを確認
5. 「プロジェクトを作成」をクリック
   - プロジェクトが作成され、詳細ページに遷移する

### 6. ⑤ミニ功績機能

1. プロジェクト詳細で進捗を投稿
2. `/profile`にアクセス
   - `first_post`功績が表示されることを確認
3. スレッドでメッセージを投稿
4. プロフィールページを再読み込み
   - `first_collab`功績が表示されることを確認

### 7. ⑥DM/グループ機能

1. プロジェクト詳細ページにアクセス
2. 「スレッド」タブをクリック
3. 「新しいスレッドを作成」でスレッドを作成
4. 作成したスレッドをクリック
5. メッセージを投稿
   - メッセージが表示されることを確認
   - 最新のメッセージが上に表示される

## トラブルシューティング

### データベースエラー

- SupabaseのRLSポリシーが正しく設定されているか確認
- インデックスが作成されているか確認
- トリガー関数が正しく動作しているか確認

### リアルタイム機能が動作しない

- SupabaseのRealtime機能が有効になっているか確認
- Presence機能の設定を確認

### 認証エラー

- 環境変数が正しく設定されているか確認
- Supabaseの認証設定を確認

### 型エラー

- TypeScriptの型定義が正しく更新されているか確認
- `npm run build`でビルドエラーがないか確認

## パフォーマンス最適化

### データベース

- 複合インデックスが適切に設定されているか確認
- 不要なクエリがないか確認

### フロントエンド

- 不要なリレンダリングがないか確認
- 画像の最適化を確認

## セキュリティ

- RLSポリシーが適切に設定されているか確認
- 認証が必要な操作が適切に保護されているか確認
- XSS対策が実装されているか確認

## 今後の拡張

- リアルタイム通知機能
- 画像アップロード機能
- 検索・フィルタリング機能
- モバイルアプリ対応 